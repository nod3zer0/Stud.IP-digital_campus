@use "../mixins/colors.scss";
@import "breakpoints";
@import "buttons";
@import "sidebar";

$header-bar-container-height: 40px;

$responsive-menu-width: 270px;

$sidebarIn: -15px;
$sidebarOut: -330px;

#responsive-toggle-desktop,
#responsive-toggle-fullscreen {
    display: none;
}

#responsive-toggle-fullscreen {
    position: relative;
    top: 4px;

    img {
        cursor: pointer;
    }
}

#non-responsive-toggle-fullscreen {
    margin-left: auto;
    margin-right: 15px;
    position: relative;
    top: 2px;

    img {
        cursor: pointer;
    }
}

#responsive-menu {
    font-size: $font-size-base;
    padding: 0 5px;
    z-index: 1002;

    .responsive-navigation-header {
        display: flex;
        margin-top: 2px;
        padding: 2px 0 5px;

        .menu-closed {
            cursor: pointer;
            transform: rotate(0deg);

            @media not prefers-reduced-motion {
                transition: 0.5s ease-in-out;
            }
        }

        .menu-open {
            cursor: pointer;
            transform: rotate(90deg);

            @media not prefers-reduced-motion {
                transition: 0.5s ease-in-out;
            }
        }
    }

}

#responsive-navigation-button {
    cursor: pointer;
    left: 10px;
    position: relative;
}

#responsive-navigation-items {
    background-color: $base-color;
    left: 0;
    max-width: $responsive-menu-width;
    overflow-y: auto;
    padding-bottom: 5px;
    position: fixed;
    top: 40px;

    /* Safari only */
    @media not all and (min-resolution: .001dpcm) {
        @supports (-webkit-appearance: none) {
            top: 43px;
        }
    }

    width: $responsive-menu-width;

    @media not prefers-reduced-motion {
        transition: all 0.5s ease-in-out;
    }

    header {
        background-image: url("#{$image-path}/sidebar/noicon-sidebar.png");
        background-size: cover;
        display: flex;
        flex-wrap: wrap;
        max-height: 250px;
        overflow-y: auto;
        padding: 10px;

        .profile-info {
            flex: auto;
            font-size: $font-size-small;
            padding: 20px;
            position: relative;

            .profile-pic {
                width: 100%;

                img,
                svg {
                    cursor: pointer;
                    height: 50px;
                    width: 50px;
                }
            }
        }

        > div {
            display: flex;
            width: 100%;

            .avatar-navigation {
                flex: auto;
                padding-left: 10px;

                .navigation-item {
                    background-color: transparent;

                    &:hover {
                        background-color: $base-color-80;
                    }
                }
            }
        }

        .open-avatarmenu,
        .close-avatarmenu {
            button {
                cursor: pointer;
                position: relative;
                top: calc(50% - 12px);
            }
        }
    }

    .main-navigation {
        margin: 0 5px;
        padding: 0 5px;
    }

    .navigation-item {
        background-color: $base-color;
        display: flex;
        flex-wrap: wrap;
        list-style-type: none;
        margin: 0px;

        &:not(:last-child) {
            border-bottom: 1px solid $white;
        }

        &.navigation-up,
        &.navigation-current {
            border-bottom: 2px solid $white;

            .navigation-icon {
                img {
                    padding-top: 0;
                }
            }

            .navigation-title {
                padding: 10px 10px 10px 0;
            }

            &:hover {
                background-color: $base-color-80;
            }

        }

        &.navigation-current {
            background-color: $base-color-60;
        }

        a {
            color: $white;
            cursor: pointer;
        }

        button {
            color: $white;
            cursor: pointer;
            display: flex;
            flex: 0;
            text-align: center;
            width: 100%;

            img,
            svg {
                padding-top: 12px;
            }

            &.navigation-in {
                border-left: 1px solid $base-color-60;
            }
        }

        &:not(.navigation-current):not(.navigation-up) {
            button:hover {
                background-color: $base-color-80;
            }
        }

    }

    .navigation-title {
        color: $white;
        flex: 1;

        > a {
            display: inline-block;
            padding: 10px 10px 10px 5px;
            text-align: left;
            width: calc(100% - 15px);

            .navigation-icon {
                flex: 0;
                width: 35px;
            }

            .navigation-text {
                flex: 1;
                padding-top: 2px;
            }

        }

        img,
        svg {
            vertical-align: text-bottom;
            margin-right: 10px;
        }

    }

    a {
        flex: 0;

        &:hover {
            background-color: $base-color-80;
        }

    }

    img, svg {
        vertical-align: text-bottom;
    }
}

.responsive-display,
.fullscreen-mode body:not(.consuming_mode) {

    body {
        display: inherit;
    }

    #responsive-menu {
        flex: 0;
    }

    #site-title,
    #quicksearch_item,
    #avatar-menu-container,
    #current-page-structure {
        display: none;
    }

    #header-links {
        > ul {
            margin-right: 10px;

            li {
                padding: 0;

                &.helpbar-container {
                    float: unset;
                    margin-top: 5px;
                    right: 5px;
                }
            }
        }

        #notification-container,
        .header_avatar_container,
        #sidebar-menu {
            display: none;
        }
    }

    #navigation-level-1 {
        display: none;
    }

    #sidebar {
        background-color: $white;
        position: absolute;
        transform: translateX($sidebarOut);
        z-index: 100;

        &.responsive-hide {
            @media not prefers-reduced-motion {
                animation: slide-out 0.5s forwards;
            }
        }

        &.responsive-show {
            @media not prefers-reduced-motion {
                animation: slide-in 0.5s forwards;
            }

            left: 15px;
            position: relative;
        }

        .sidebar-image {
            display: none;
        }

        > .sidebar-widget {
            margin-top: 0;
        }

        > .sidebar-widget ~ .sidebar-widget {
            margin-top: 15px;
        }

        @keyframes slide-in {
            100% {
                transform: translateX($sidebarIn);
            }
        }


        @keyframes slide-out {
            0% {
                transform: translateX($sidebarIn);
            }
            100% {
                transform: translateX($sidebarOut);
            }
        }
    }

    #sidebar-navigation {
        display: none !important;
    }

    #current-page-structure {
        #navigation-level-2 {
            display: none !important;
        }
    }

    #responsive-contentbar {
        margin-bottom: 15px;
        padding-bottom: 0.5em;
        padding-left: 5px;

        .contentbar-nav,
        .cw-ribbon-nav {
            width: auto;
            margin-left: 5px;

            .contentbar-button {

                &.contentbar-button-sidebar {
                    cursor: pointer;
                    margin-right: 10px;

                    img {
                        transform: rotate(0deg);
                    }

                    &.contentbar-button-sidebar-open {
                        img {
                            transform: rotate(180deg);
                        }
                    }
                }
            }

        }

        .contentbar-wrapper-left {
            flex: 1;
            max-width: unset;

            & > .contentbar-icon {
                margin-right: 15px;
            }

            .contentbar-breadcrumb {
                font-size: $font-size-large;
                width: calc(100% - 75px);

                > img {
                    margin-left: 15px;
                    width: 24px;
                }
            }
        }

        > .contentbar-wrapper-right {
            position: relative;
            left: 5px;

            .contentbar-button,
            nav {
                position: relative;
            }
        }

        &.cw-ribbon {
            margin-top: 4px;

            .cw-ribbon-tools {
                right: 0;
                top: 96px;
            }
        }
    }

    #toc {
        position: absolute;
        right: -8px;
        top: 82px;
    }

    #toc_header {
        height: 47px;
    }

    #main-footer {
        display: none;
    }
}

.responsive-display:not(.fullscreen-mode) {
    #responsive-menu {
        width: calc(100% - 56px);
    }

    #responsive-navigation-items {
        max-width: unset;
        width: 100%;
    }

    #sidebar {
        height: 100%;
        position: fixed;
        transform: translateX($sidebarOut);
        -webkit-transform: translateX($sidebarOut);
        top: 80px;
        z-index: 100;

        &.responsive-show {
            width: 100%;

            .sidebar-widget {
                width: calc(100% - 30px);
            }
        }
    }
}

/* Settings especially for fullscreen mode */
.fullscreen-mode:not(.responsive-display) {
    body:not(.consuming_mode) {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;

        #top-bar {
            max-height: unset;
            opacity: 1;
            overflow: unset;
        }

        #responsive-menu {
            max-width: calc(100% - 100px);
            min-width: calc(100% - 100px);
            width: calc(100% - 100px);
        }

        #main-header {
            flex-basis: 100%;
        }

        #responsive-toggle-fullscreen {
            display: block;
            margin-right: 5px;
        }

        .contentbar:not(#responsive-contentbar) {
            display: none;
        }

        #sidebar {
            flex: 0;

            &.responsive-hide {
                top: 110px;
            }
        }

        #content-wrapper {
            flex: 1;
            height: 100%;
        }
    }
}

.consuming_mode {
    display: unset;

    #responsive-contentbar {
        display: none;
    }
}

html:not(.responsive-display):not(.fullscreen-mode) {
    #responsive-navigation {
        display: none;
    }

    body.fixed {
        #responsive-navigation {
            display: block;
        }

        #responsive-navigation-items {
            margin-top: -5px;
            width: 100%;
        }
    }

}

/* content from old responsive.less */
.responsive-display {
    @include media-breakpoint-small-down() {
        #navigation-level-1,
        #site-title,
        #navigation-level1-items,
        .current_page,
        #tabs,
        #site-title,
        #footer,
        .tabs_wrapper .colorblock {
            display: none !important;
        }

        #layout_wrapper #current-page-structure {
            #navigation-level-2 {
                display: flex;
                flex-direction: row;
                flex-wrap: nowrap;

                background-color: $dark-gray-color-10;
                border-bottom: 1px solid $dark-gray-color-40;

                .colorblock,
                #context-title,
                .context_icon,
                .tabs_wrapper {
                    transition: unset;
                }

                #context-title,
                .tabs_wrapper {
                    background: transparent;
                    border-width: 0;
                    flex: 1;
                }

                #context-title {
                    flex: 1;

                    overflow: hidden;
                    text-overflow: ellipsis;
                    white-space: nowrap;

                    + .tabs_wrapper {
                        flex: 0;
                        align-self: flex-end;
                    }
                }
            }
        }
        #layout_wrapper #current-page-structure .tabs_wrapper {
            justify-content: flex-end;
            .helpbar-container {
                top: 0px;
                right: 6px;
            }
        }
        .responsive-hidden {
            display: none;
        }
        #notification_marker {
            display: inline-block;
            margin-top: 0;
            vertical-align: initial;

            width: 22px;
            padding-left: 5px;
            padding-right: 5px;
            height: 20px;
            line-height: 20px;
        }

        #avatar-menu-container {
            position: relative;
            bottom: 0px;
            right: 0px;
            line-height: 20px !important;

            #avatar-menu {
                display: none;
            }

            &::after {
                display: none !important;
            }
        }

        #top-bar {
            box-sizing: border-box;
            height: $header-bar-container-height;
            position: fixed;
            top: 0;
            margin-left: 0px;
            margin-right: 0px;
            width: 100%;
        }

        #header-links, #header-links ul {
            box-sizing: border-box;
            flex: 1;
        }

        #header-links {
            flex: 1 !important;
            .list {
                &::before,
                &::after {
                    display: none;
                }
                $width: 300px;
                $arrow-height: 10px;

                margin-top: 2px;
                width: $width;
                max-width: $width;

                &.below {
                    left: (-$width + 90px);
                    &:before {
                        left: ($width - 90px);
                    }
                }

            }

            > ul > li {
                flex: 1 0 auto;

                &:first-child {
                    flex: 1 1 100%;
                }
            }
        }

        #notification-container {
            position: inherit !important;
            /*top: 8px;*/
            width: 32px;
            height: 20px;
        }

        #responsive-container {
            display: block;
        }

        #current-page-structure {
            margin-left: 0;
            margin-right: 0;
        }

        #current-page-structure, #top-bar, #navigation-level-1, #layout_content {
            min-width: inherit !important;
        }

        #layout_content {
            margin: 0px 4px;
        }

        #index,
        #login,
        #request_new_password,
        #web_migrate {
            div.index_container {
                height: calc(100% - 74px);
                position: static;
                top: 0;

                div.messagebox,
                div.index_main {
                    margin: 1em auto;
                }
            }

            #background-desktop,
            #background-mobile {
                position: fixed;
            }
        }
    }

    @include media-breakpoint-tiny-down() {
        #index,
        #login,
        #request_new_password,
        #web_migrate {
            div.index_container {
                div.messagebox,
                div.index_main {
                    margin: 0 auto;
                }
            }
        }
    }
}

.responsive-display {
    #quicksearch_item {
        padding: 0;
    }
    #search_sem_quick_search_frame {
        display: flex;
        flex-direction: row;
        justify-content: flex-end;

        .quicksearchbox {
            transition: all 300ms;
            opacity: 0;
            max-width: 0;
        }

        &.open {
            .quicksearchbox {
                opacity: 1;
                max-width: 1000px;
                width: 100% !important;
            }
        }
    }

    #header-links {
        ul {
            li:first-child {
                flex: 1 0 auto;
            }
            li#quicksearch_item {
                flex: 1 1 100%;
            }
        }
    }

    table.default tfoot .button {
        margin-top: 0.5em;
        margin-bottom: 0.5em;
    }

    .ui-dialog.ui-widget.ui-widget-content.studip-confirmation {
        min-width: 20vw;
        max-width: 100vw;
    }
}
